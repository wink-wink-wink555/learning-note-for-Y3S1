# æƒé™ç®¡ç†ç³»ç»Ÿ - å¿«é€Ÿæµ‹è¯•æŒ‡å—

## å‰ç½®æ¡ä»¶

ç¡®ä¿å·²ç»è¿è¡Œäº†æ‰€æœ‰SQLè„šæœ¬ï¼š
- âœ… 01_create_database.sql
- âœ… 02_create_tables.sql
- âœ… 03_create_triggers.sql
- âœ… 04_create_procedures.sql
- âœ… 05_insert_sample_data.sql

## ä¸€ã€åˆ›å»ºæµ‹è¯•ç”¨æˆ·

åœ¨MySQL Workbenchä¸­æ‰§è¡Œï¼š

```sql
USE textbook_management;

-- 1. ç®¡ç†å‘˜
INSERT INTO user (username, password, real_name, role, department, email, status)
VALUES ('admin', 'admin123', 'å¼ ç®¡ç†', 'ç®¡ç†å‘˜', 'ç®¡ç†éƒ¨', 'admin@example.com', 1);

-- 2. ä»“åº“ç®¡ç†å‘˜
INSERT INTO user (username, password, real_name, role, department, email, status)
VALUES ('warehouse', 'warehouse123', 'æä»“ç®¡', 'ä»“åº“ç®¡ç†å‘˜', 'ä»“å‚¨éƒ¨', 'warehouse@example.com', 1);

-- 3. æ•™å¸ˆ
INSERT INTO user (username, password, real_name, role, department, email, status)
VALUES ('teacher', 'teacher123', 'ç‹è€å¸ˆ', 'æ•™å¸ˆ', 'è®¡ç®—æœºç³»', 'teacher@example.com', 1);

-- 4. æ™®é€šç”¨æˆ·
INSERT INTO user (username, password, real_name, role, department, email, status)
VALUES ('user', 'user123', 'èµµå­¦ç”Ÿ', 'æ™®é€šç”¨æˆ·', 'è½¯ä»¶å·¥ç¨‹', 'user@example.com', 1);

-- æŸ¥çœ‹åˆ›å»ºç»“æœ
SELECT user_id, username, real_name, role, department FROM user;
```

## äºŒã€å¯åŠ¨é¡¹ç›®

```bash
# 1. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼ˆå¦‚æœæœ‰ï¼‰
# source venv/bin/activate  # Linux/Mac
# venv\Scripts\activate     # Windows

# 2. å®‰è£…ä¾èµ–ï¼ˆå¦‚æœè¿˜æ²¡è£…ï¼‰
pip install -r requirements.txt

# 3. å¯åŠ¨é¡¹ç›®
python run.py
```

é¡¹ç›®åº”è¯¥è¿è¡Œåœ¨ `http://127.0.0.1:5000`

## ä¸‰ã€APIæµ‹è¯•ï¼ˆä½¿ç”¨Postmanæˆ–curlï¼‰

### 3.1 ç™»å½•è·å–Token

#### ç®¡ç†å‘˜ç™»å½•
```bash
POST http://127.0.0.1:5000/api/v1/auth/login
Content-Type: application/json

{
  "username": "admin",
  "password": "admin123"
}

# å“åº”ï¼šå¤åˆ¶ access_token
```

#### æ•™å¸ˆç™»å½•
```bash
POST http://127.0.0.1:5000/api/v1/auth/login
Content-Type: application/json

{
  "username": "teacher",
  "password": "teacher123"
}
```

#### æ™®é€šç”¨æˆ·ç™»å½•
```bash
POST http://127.0.0.1:5000/api/v1/auth/login
Content-Type: application/json

{
  "username": "user",
  "password": "user123"
}
```

**å°†è·å–åˆ°çš„ access_token ç”¨äºåç»­è¯·æ±‚çš„ Authorization å¤´ï¼š**
```
Authorization: Bearer <your_access_token>
```

---

### 3.2 æµ‹è¯•æƒé™æ§åˆ¶

#### âœ… æµ‹è¯•1ï¼šæ•™å¸ˆå°è¯•åˆ›å»ºæ•™æï¼ˆåº”è¯¥å¤±è´¥ï¼‰

```bash
POST http://127.0.0.1:5000/api/v1/textbooks
Authorization: Bearer <teacher_token>
Content-Type: application/json

{
  "isbn": "ISBN1234567890",
  "textbook_name": "Pythoné«˜çº§ç¼–ç¨‹",
  "author": "å¼ ä¸‰",
  "publisher_id": 1,
  "type_id": 1,
  "edition": "ç¬¬1ç‰ˆ",
  "price": 89.00
}

# é¢„æœŸç»“æœï¼š403 Forbidden - "éœ€è¦ä»¥ä¸‹è§’è‰²ä¹‹ä¸€ï¼šç®¡ç†å‘˜"
```

#### âœ… æµ‹è¯•2ï¼šç®¡ç†å‘˜åˆ›å»ºæ•™æï¼ˆåº”è¯¥æˆåŠŸï¼‰

```bash
POST http://127.0.0.1:5000/api/v1/textbooks
Authorization: Bearer <admin_token>
Content-Type: application/json

{
  "isbn": "ISBN9876543210",
  "textbook_name": "æ•°æ®åº“åŸç†ä¸åº”ç”¨",
  "author": "æå››",
  "publisher_id": 1,
  "type_id": 1,
  "edition": "ç¬¬2ç‰ˆ",
  "publication_date": "2025-01-01",
  "price": 68.00,
  "description": "æ•°æ®åº“è¯¾ç¨‹æ•™æ"
}

# é¢„æœŸç»“æœï¼š201 Created
# æ£€æŸ¥ï¼šè§¦å‘å™¨åº”è¯¥è‡ªåŠ¨åˆ›å»ºåº“å­˜è®°å½•ï¼ˆåˆå§‹åº“å­˜ä¸º0ï¼‰
```

éªŒè¯è§¦å‘å™¨ï¼š
```sql
-- åœ¨MySQLä¸­æ£€æŸ¥
SELECT * FROM inventory WHERE textbook_id = (SELECT textbook_id FROM textbook WHERE isbn = 'ISBN9876543210');
-- åº”è¯¥æœ‰ä¸€æ¡è®°å½•ï¼Œcurrent_quantity = 0
```

---

### 3.3 æµ‹è¯•è®¢è´­æµç¨‹

#### âœ… æµ‹è¯•3ï¼šæ•™å¸ˆåˆ›å»ºè®¢å•ï¼ˆåº”è¯¥æˆåŠŸï¼‰

```bash
POST http://127.0.0.1:5000/api/v1/purchase-orders
Authorization: Bearer <teacher_token>
Content-Type: application/json

{
  "textbook_id": 1,
  "order_quantity": 100,
  "order_date": "2026-01-10",
  "expected_date": "2026-01-20",
  "remarks": "æ–°å­¦æœŸæ•™æè®¢è´­"
}

# é¢„æœŸç»“æœï¼š201 Created
# order_no åº”è¯¥è‡ªåŠ¨ç”Ÿæˆï¼ˆPO20260110001ï¼‰
# order_person åº”è¯¥è‡ªåŠ¨å¡«å……ä¸º"ç‹è€å¸ˆ"
# order_status åº”è¯¥æ˜¯"å¾…å®¡æ ¸"
```

#### âœ… æµ‹è¯•4ï¼šæ•™å¸ˆæŸ¥çœ‹è®¢å•åˆ—è¡¨ï¼ˆåªèƒ½çœ‹åˆ°è‡ªå·±çš„ï¼‰

```bash
GET http://127.0.0.1:5000/api/v1/purchase-orders
Authorization: Bearer <teacher_token>

# é¢„æœŸç»“æœï¼šåªè¿”å› order_person = "ç‹è€å¸ˆ" çš„è®¢å•
```

#### âœ… æµ‹è¯•5ï¼šç®¡ç†å‘˜æŸ¥çœ‹è®¢å•åˆ—è¡¨ï¼ˆèƒ½çœ‹åˆ°æ‰€æœ‰ï¼‰

```bash
GET http://127.0.0.1:5000/api/v1/purchase-orders
Authorization: Bearer <admin_token>

# é¢„æœŸç»“æœï¼šè¿”å›æ‰€æœ‰è®¢å•
```

#### âœ… æµ‹è¯•6ï¼šæ•™å¸ˆå°è¯•å®¡æ ¸è®¢å•ï¼ˆåº”è¯¥å¤±è´¥ï¼‰

```bash
POST http://127.0.0.1:5000/api/v1/purchase-orders/1/approve
Authorization: Bearer <teacher_token>
Content-Type: application/json

{
  "approver": "ç‹è€å¸ˆ"
}

# é¢„æœŸç»“æœï¼š403 Forbidden - "éœ€è¦ä»¥ä¸‹è§’è‰²ä¹‹ä¸€ï¼šç®¡ç†å‘˜, ä»“åº“ç®¡ç†å‘˜"
```

#### âœ… æµ‹è¯•7ï¼šä»“åº“ç®¡ç†å‘˜å®¡æ ¸è®¢å•ï¼ˆåº”è¯¥æˆåŠŸï¼‰

```bash
POST http://127.0.0.1:5000/api/v1/purchase-orders/1/approve
Authorization: Bearer <warehouse_token>
Content-Type: application/json

{
  "approver": "æä»“ç®¡"
}

# é¢„æœŸç»“æœï¼š200 OK
# order_status åº”è¯¥å˜ä¸º"å·²å®¡æ ¸"
```

---

### 3.4 æµ‹è¯•å…¥åº“æµç¨‹

#### âœ… æµ‹è¯•8ï¼šæ•™å¸ˆå°è¯•åˆ›å»ºå…¥åº“å•ï¼ˆåº”è¯¥å¤±è´¥ï¼‰

```bash
POST http://127.0.0.1:5000/api/v1/stock-ins
Authorization: Bearer <teacher_token>
Content-Type: application/json

{
  "order_id": 1,
  "textbook_id": 1,
  "stock_in_quantity": 80,
  "stock_in_date": "2026-01-15",
  "warehouse_person": "æä»“ç®¡",
  "actual_quantity": 80
}

# é¢„æœŸç»“æœï¼š403 Forbidden
```

#### âœ… æµ‹è¯•9ï¼šä»“åº“ç®¡ç†å‘˜åˆ›å»ºå…¥åº“å•ï¼ˆåº”è¯¥æˆåŠŸï¼‰

```bash
POST http://127.0.0.1:5000/api/v1/stock-ins
Authorization: Bearer <warehouse_token>
Content-Type: application/json

{
  "order_id": 1,
  "textbook_id": 1,
  "stock_in_quantity": 80,
  "stock_in_date": "2026-01-15",
  "warehouse_person": "æä»“ç®¡",
  "quality_status": "åˆæ ¼",
  "actual_quantity": 80,
  "remarks": "ç¬¬ä¸€æ‰¹åˆ°è´§"
}

# é¢„æœŸç»“æœï¼š201 Created
# stock_in_no åº”è¯¥è‡ªåŠ¨ç”Ÿæˆï¼ˆSI20260110001ï¼‰
# è§¦å‘å™¨åº”è¯¥è‡ªåŠ¨æ‰§è¡Œï¼š
#   1. åº“å­˜å¢åŠ 80
#   2. è®¢å• arrived_quantity å¢åŠ 80
#   3. è®¢å•çŠ¶æ€å˜ä¸º"éƒ¨åˆ†åˆ°è´§"ï¼ˆå› ä¸ºè®¢è´­äº†100ï¼‰
```

éªŒè¯è§¦å‘å™¨ï¼š
```sql
-- åœ¨MySQLä¸­æ£€æŸ¥
SELECT current_quantity FROM inventory WHERE textbook_id = 1;
-- åº”è¯¥æ˜¾ç¤º 80

SELECT arrived_quantity, order_status FROM purchase_order WHERE order_id = 1;
-- arrived_quantity åº”è¯¥æ˜¯ 80ï¼Œorder_status åº”è¯¥æ˜¯ "éƒ¨åˆ†åˆ°è´§"
```

#### âœ… æµ‹è¯•10ï¼šå†æ¬¡å…¥åº“å®Œæˆè®¢å•

```bash
POST http://127.0.0.1:5000/api/v1/stock-ins
Authorization: Bearer <warehouse_token>
Content-Type: application/json

{
  "order_id": 1,
  "textbook_id": 1,
  "stock_in_quantity": 20,
  "stock_in_date": "2026-01-18",
  "warehouse_person": "æä»“ç®¡",
  "quality_status": "åˆæ ¼",
  "actual_quantity": 20,
  "remarks": "ç¬¬äºŒæ‰¹åˆ°è´§"
}

# é¢„æœŸç»“æœï¼š201 Created
# è§¦å‘å™¨åº”è¯¥è‡ªåŠ¨æ‰§è¡Œï¼š
#   1. åº“å­˜å¢åŠ 20ï¼Œæ€»å…±100
#   2. è®¢å• arrived_quantity å¢åŠ 20ï¼Œæ€»å…±100
#   3. è®¢å•çŠ¶æ€å˜ä¸º"å·²åˆ°è´§"ï¼ˆ100 >= 100ï¼‰
```

éªŒè¯ï¼š
```sql
SELECT current_quantity FROM inventory WHERE textbook_id = 1;
-- åº”è¯¥æ˜¾ç¤º 100

SELECT arrived_quantity, order_status FROM purchase_order WHERE order_id = 1;
-- arrived_quantity åº”è¯¥æ˜¯ 100ï¼Œorder_status åº”è¯¥æ˜¯ "å·²åˆ°è´§"
```

---

### 3.5 æµ‹è¯•é¢†ç”¨æµç¨‹

#### âœ… æµ‹è¯•11ï¼šæ™®é€šç”¨æˆ·åˆ›å»ºé¢†ç”¨ç”³è¯·ï¼ˆåº”è¯¥æˆåŠŸï¼‰

```bash
POST http://127.0.0.1:5000/api/v1/requisitions
Authorization: Bearer <user_token>
Content-Type: application/json

{
  "textbook_id": 1,
  "requisition_quantity": 30,
  "requisition_date": "2026-01-16",
  "department": "è½¯ä»¶å·¥ç¨‹",
  "requisition_person": "èµµå­¦ç”Ÿ",
  "requisition_purpose": "è¯¾ç¨‹å­¦ä¹ "
}

# é¢„æœŸç»“æœï¼š201 Created
# requisition_no åº”è¯¥è‡ªåŠ¨ç”Ÿæˆï¼ˆRQ20260110001ï¼‰
# approval_status åº”è¯¥æ˜¯"å¾…å®¡æ‰¹"
```

#### âœ… æµ‹è¯•12ï¼šæ™®é€šç”¨æˆ·æŸ¥çœ‹é¢†ç”¨åˆ—è¡¨ï¼ˆåªèƒ½çœ‹åˆ°è‡ªå·±çš„ï¼‰

```bash
GET http://127.0.0.1:5000/api/v1/requisitions
Authorization: Bearer <user_token>

# é¢„æœŸç»“æœï¼šåªè¿”å› requisition_person = "èµµå­¦ç”Ÿ" çš„è®°å½•
```

#### âœ… æµ‹è¯•13ï¼šæ™®é€šç”¨æˆ·å°è¯•å®¡æ‰¹é¢†ç”¨ï¼ˆåº”è¯¥å¤±è´¥ï¼‰

```bash
POST http://127.0.0.1:5000/api/v1/requisitions/1/approve
Authorization: Bearer <user_token>
Content-Type: application/json

{
  "approver": "èµµå­¦ç”Ÿ",
  "actual_quantity": 30
}

# é¢„æœŸç»“æœï¼š403 Forbidden
```

#### âœ… æµ‹è¯•14ï¼šä»“åº“ç®¡ç†å‘˜å®¡æ‰¹å¹¶å‘æ”¾ï¼ˆåº”è¯¥æˆåŠŸï¼‰

```bash
POST http://127.0.0.1:5000/api/v1/requisitions/1/approve
Authorization: Bearer <warehouse_token>
Content-Type: application/json

{
  "approver": "æä»“ç®¡",
  "actual_quantity": 30,
  "remarks": "å·²å‘æ”¾"
}

# é¢„æœŸç»“æœï¼š200 OK
# è§¦å‘å™¨åº”è¯¥è‡ªåŠ¨æ‰§è¡Œï¼š
#   1. åº“å­˜å‡å°‘30ï¼Œä»100å˜æˆ70
#   2. approval_status å˜ä¸º"å·²å‘æ”¾"
#   3. actual_quantity è®¾ç½®ä¸º30
```

éªŒè¯è§¦å‘å™¨ï¼š
```sql
SELECT current_quantity, total_out_quantity FROM inventory WHERE textbook_id = 1;
-- current_quantity åº”è¯¥æ˜¯ 70
-- total_out_quantity åº”è¯¥æ˜¯ 30

SELECT approval_status, actual_quantity FROM requisition WHERE requisition_id = 1;
-- approval_status åº”è¯¥æ˜¯ "å·²å‘æ”¾"
-- actual_quantity åº”è¯¥æ˜¯ 30
```

#### âœ… æµ‹è¯•15ï¼šåº“å­˜ä¸è¶³æ—¶å‘æ”¾ï¼ˆåº”è¯¥å¤±è´¥ï¼‰

å…ˆåˆ›å»ºä¸€ä¸ªè¶…è¿‡åº“å­˜çš„é¢†ç”¨ç”³è¯·ï¼š
```bash
POST http://127.0.0.1:5000/api/v1/requisitions
Authorization: Bearer <teacher_token>
Content-Type: application/json

{
  "textbook_id": 1,
  "requisition_quantity": 100,
  "requisition_date": "2026-01-17",
  "department": "è®¡ç®—æœºç³»",
  "requisition_person": "ç‹è€å¸ˆ",
  "requisition_purpose": "æ•™å­¦ç”¨"
}
```

å°è¯•å®¡æ‰¹ï¼ˆå½“å‰åº“å­˜åªæœ‰70ï¼‰ï¼š
```bash
POST http://127.0.0.1:5000/api/v1/requisitions/2/approve
Authorization: Bearer <warehouse_token>
Content-Type: application/json

{
  "approver": "æä»“ç®¡",
  "actual_quantity": 100
}

# é¢„æœŸç»“æœï¼š400 æˆ– 500 é”™è¯¯
# é”™è¯¯ä¿¡æ¯ï¼š"åº“å­˜æ•°é‡ä¸è¶³ï¼Œæ— æ³•å®Œæˆå‡ºåº“æ“ä½œ"ï¼ˆè§¦å‘å™¨æŠ›å‡ºï¼‰
```

---

### 3.6 æµ‹è¯•ç»Ÿè®¡åŠŸèƒ½

#### âœ… æµ‹è¯•16ï¼šæ™®é€šç”¨æˆ·æŸ¥çœ‹ç»Ÿè®¡ï¼ˆåº”è¯¥å¤±è´¥ï¼‰

```bash
GET http://127.0.0.1:5000/api/v1/statistics/by-type
Authorization: Bearer <user_token>

# é¢„æœŸç»“æœï¼š403 Forbidden
```

#### âœ… æµ‹è¯•17ï¼šæ•™å¸ˆæŸ¥çœ‹ç»Ÿè®¡ï¼ˆåº”è¯¥æˆåŠŸï¼‰

```bash
GET http://127.0.0.1:5000/api/v1/statistics/by-type
Authorization: Bearer <teacher_token>

# é¢„æœŸç»“æœï¼š200 OKï¼Œè¿”å›æŒ‰æ•™æç±»å‹ç»Ÿè®¡çš„æ•°æ®
```

#### âœ… æµ‹è¯•18ï¼šæ•™å¸ˆæŸ¥çœ‹åº“å­˜é¢„è­¦ï¼ˆåº”è¯¥å¤±è´¥ï¼‰

```bash
GET http://127.0.0.1:5000/api/v1/statistics/inventory-warnings
Authorization: Bearer <teacher_token>

# é¢„æœŸç»“æœï¼š403 Forbidden
```

#### âœ… æµ‹è¯•19ï¼šä»“åº“ç®¡ç†å‘˜æŸ¥çœ‹åº“å­˜é¢„è­¦ï¼ˆåº”è¯¥æˆåŠŸï¼‰

```bash
GET http://127.0.0.1:5000/api/v1/statistics/inventory-warnings
Authorization: Bearer <warehouse_token>

# é¢„æœŸç»“æœï¼š200 OKï¼Œè¿”å›åº“å­˜é¢„è­¦æ•°æ®
```

#### âœ… æµ‹è¯•20ï¼šæŒ‰æ—¥æœŸèŒƒå›´ç»Ÿè®¡

```bash
GET http://127.0.0.1:5000/api/v1/statistics/by-date?start_date=2026-01-01&end_date=2026-01-31
Authorization: Bearer <teacher_token>

# é¢„æœŸç»“æœï¼š200 OKï¼Œè¿”å›1æœˆä»½çš„ç»Ÿè®¡æ•°æ®
```

---

### 3.7 æµ‹è¯•åˆ é™¤å…¥åº“å•ï¼ˆå›é€€åº“å­˜ï¼‰

#### âœ… æµ‹è¯•21ï¼šä»“åº“ç®¡ç†å‘˜å°è¯•åˆ é™¤ï¼ˆåº”è¯¥å¤±è´¥ï¼‰

```bash
DELETE http://127.0.0.1:5000/api/v1/stock-ins/1
Authorization: Bearer <warehouse_token>

# é¢„æœŸç»“æœï¼š403 Forbidden - åªæœ‰ç®¡ç†å‘˜å¯ä»¥åˆ é™¤
```

#### âœ… æµ‹è¯•22ï¼šç®¡ç†å‘˜åˆ é™¤å…¥åº“å•ï¼ˆåº”è¯¥æˆåŠŸï¼‰

```bash
DELETE http://127.0.0.1:5000/api/v1/stock-ins/1
Authorization: Bearer <admin_token>

# é¢„æœŸç»“æœï¼š200 OK
# è§¦å‘å™¨åº”è¯¥è‡ªåŠ¨æ‰§è¡Œï¼š
#   1. åº“å­˜å›é€€80ï¼ˆä»70å˜æˆ-10ï¼Ÿä¸å¯¹ï¼Œåº”è¯¥æ£€æŸ¥æ˜¯å¦è¶³å¤Ÿï¼‰
#   2. è®¢å• arrived_quantity å‡å°‘80
```

**æ³¨æ„ï¼š**å¦‚æœå·²ç»å‘æ”¾äº†30æœ¬ï¼Œç°åœ¨åº“å­˜åªæœ‰70æœ¬ï¼Œåˆ é™¤ç¬¬ä¸€æ‰¹å…¥åº“çš„80æœ¬ä¼šå¯¼è‡´åº“å­˜ä¸è¶³ã€‚è§¦å‘å™¨ä¼šæŠ›å‡ºé”™è¯¯ï¼š"åº“å­˜æ•°é‡ä¸è¶³ï¼Œæ— æ³•åˆ é™¤å…¥åº“è®°å½•"ã€‚

è¿™æ˜¯æ­£ç¡®çš„è¡Œä¸ºï¼Œä¿æŠ¤æ•°æ®å®Œæ•´æ€§ï¼

---

## å››ã€å®Œæ•´æµ‹è¯•æµç¨‹

### æµç¨‹1ï¼šå®Œæ•´çš„æ•™æé‡‡è´­åˆ°å‘æ”¾æµç¨‹

1. **ç®¡ç†å‘˜**åˆ›å»ºæ•™æ â†’ è§¦å‘å™¨è‡ªåŠ¨åˆ›å»ºåº“å­˜ï¼ˆ0æœ¬ï¼‰
2. **æ•™å¸ˆ**åˆ›å»ºè®¢è´­å•ï¼ˆ100æœ¬ï¼‰â†’ è‡ªåŠ¨ç”Ÿæˆè®¢å•å·
3. **ä»“åº“ç®¡ç†å‘˜**å®¡æ ¸è®¢å• â†’ çŠ¶æ€å˜ä¸º"å·²å®¡æ ¸"
4. **ä»“åº“ç®¡ç†å‘˜**åˆ›å»ºå…¥åº“å•ï¼ˆ80æœ¬ï¼‰â†’ åº“å­˜å˜ä¸º80ï¼Œè®¢å•çŠ¶æ€"éƒ¨åˆ†åˆ°è´§"
5. **ä»“åº“ç®¡ç†å‘˜**åˆ›å»ºå…¥åº“å•ï¼ˆ20æœ¬ï¼‰â†’ åº“å­˜å˜ä¸º100ï¼Œè®¢å•çŠ¶æ€"å·²åˆ°è´§"
6. **æ™®é€šç”¨æˆ·**åˆ›å»ºé¢†ç”¨ç”³è¯·ï¼ˆ30æœ¬ï¼‰â†’ è‡ªåŠ¨ç”Ÿæˆé¢†ç”¨å•å·
7. **ä»“åº“ç®¡ç†å‘˜**å®¡æ‰¹å¹¶å‘æ”¾ï¼ˆ30æœ¬ï¼‰â†’ åº“å­˜å˜ä¸º70

### æµç¨‹2ï¼šæƒé™éš”ç¦»æµ‹è¯•

1. **æ•™å¸ˆ**å°è¯•åˆ›å»ºæ•™æ â†’ âŒ 403
2. **æ•™å¸ˆ**å°è¯•å®¡æ ¸è®¢å• â†’ âŒ 403
3. **æ•™å¸ˆ**å°è¯•å…¥åº“ â†’ âŒ 403
4. **æ™®é€šç”¨æˆ·**å°è¯•æŸ¥çœ‹ç»Ÿè®¡ â†’ âŒ 403
5. **æ™®é€šç”¨æˆ·**å°è¯•å®¡æ‰¹é¢†ç”¨ â†’ âŒ 403

### æµç¨‹3ï¼šæ•°æ®æƒé™æµ‹è¯•

1. **æ•™å¸ˆA**åˆ›å»ºè®¢å• â†’ âœ… æˆåŠŸ
2. **æ•™å¸ˆB**ç™»å½•æŸ¥çœ‹è®¢å•åˆ—è¡¨ â†’ âœ… åªèƒ½çœ‹åˆ°è‡ªå·±çš„è®¢å•
3. **æ•™å¸ˆB**å°è¯•ä¿®æ”¹æ•™å¸ˆAçš„è®¢å• â†’ âŒ 403

---

## äº”ã€åœ¨MySQLä¸­éªŒè¯è§¦å‘å™¨å’Œå­˜å‚¨è¿‡ç¨‹

### éªŒè¯å­˜å‚¨è¿‡ç¨‹

```sql
-- 1. æµ‹è¯•ç”Ÿæˆè®¢å•ç¼–å·
CALL sp_generate_order_no(@order_no);
SELECT @order_no;

-- 2. æµ‹è¯•ç»Ÿè®¡
CALL sp_statistics_by_type();
CALL sp_statistics_by_publisher();
CALL sp_inventory_warning();

-- 3. æµ‹è¯•æŒ‰æ•™æç»Ÿè®¡
CALL sp_statistics_by_textbook(1);

-- 4. æµ‹è¯•æŒ‰æ—¥æœŸèŒƒå›´ç»Ÿè®¡
CALL sp_statistics_by_date_range('2026-01-01', '2026-01-31');
```

### éªŒè¯è§¦å‘å™¨

```sql
-- 1. æŸ¥çœ‹åº“å­˜å˜åŒ–
SELECT 
    t.textbook_name,
    i.current_quantity,
    i.total_in_quantity,
    i.total_out_quantity
FROM inventory i
JOIN textbook t ON i.textbook_id = t.textbook_id;

-- 2. æŸ¥çœ‹è®¢å•çŠ¶æ€
SELECT 
    order_no,
    order_quantity,
    arrived_quantity,
    order_status
FROM purchase_order;

-- 3. æŸ¥çœ‹é¢†ç”¨çŠ¶æ€
SELECT 
    requisition_no,
    requisition_person,
    requisition_quantity,
    actual_quantity,
    approval_status
FROM requisition;
```

---

## å…­ã€å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1ï¼š403 Forbidden
**åŸå› ï¼š**æƒé™ä¸è¶³  
**è§£å†³ï¼š**æ£€æŸ¥ç”¨æˆ·è§’è‰²å’ŒAPIæƒé™è¦æ±‚

### é—®é¢˜2ï¼šè§¦å‘å™¨æ²¡æœ‰æ‰§è¡Œ
**åŸå› ï¼š**å¯èƒ½æ˜¯æ‰‹åŠ¨åœ¨MySQLä¸­æ’å…¥æ•°æ®  
**è§£å†³ï¼š**é€šè¿‡APIæ“ä½œï¼Œè§¦å‘å™¨æ‰ä¼šç”Ÿæ•ˆ

### é—®é¢˜3ï¼šåº“å­˜ä¸è¶³é”™è¯¯
**åŸå› ï¼š**è§¦å‘å™¨æ£€æŸ¥åˆ°åº“å­˜ä¸è¶³  
**è§£å†³ï¼š**è¿™æ˜¯æ­£ç¡®çš„è¡Œä¸ºï¼Œéœ€è¦å…ˆå…¥åº“

### é—®é¢˜4ï¼šTokenè¿‡æœŸ
**åŸå› ï¼š**JWT Tokenæœ‰æ•ˆæœŸï¼ˆé»˜è®¤15åˆ†é’Ÿï¼‰  
**è§£å†³ï¼š**é‡æ–°ç™»å½•è·å–æ–°Token

---

## ä¸ƒã€æµ‹è¯•æ£€æŸ¥æ¸…å•

- [ ] ç®¡ç†å‘˜å¯ä»¥è®¿é—®æ‰€æœ‰åŠŸèƒ½
- [ ] ä»“åº“ç®¡ç†å‘˜ä¸èƒ½ç¼–è¾‘æ•™æã€å‡ºç‰ˆç¤¾
- [ ] æ•™å¸ˆä¸èƒ½è¿›è¡Œå…¥åº“æ“ä½œ
- [ ] æ•™å¸ˆåªèƒ½æŸ¥çœ‹è‡ªå·±çš„è®¢å•
- [ ] æ™®é€šç”¨æˆ·ä¸èƒ½æŸ¥çœ‹ç»Ÿè®¡æŠ¥è¡¨
- [ ] æ™®é€šç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±çš„é¢†ç”¨è®°å½•
- [ ] å…¥åº“ååº“å­˜è‡ªåŠ¨å¢åŠ ï¼ˆè§¦å‘å™¨ï¼‰
- [ ] é¢†ç”¨å®¡æ‰¹ååº“å­˜è‡ªåŠ¨æ‰£å‡ï¼ˆè§¦å‘å™¨ï¼‰
- [ ] åˆ é™¤å…¥åº“å•æ—¶åº“å­˜è‡ªåŠ¨å›é€€ï¼ˆè§¦å‘å™¨ï¼‰
- [ ] è®¢å•ç¼–å·è‡ªåŠ¨ç”Ÿæˆï¼ˆå­˜å‚¨è¿‡ç¨‹ï¼‰
- [ ] å…¥åº“å•å·è‡ªåŠ¨ç”Ÿæˆï¼ˆå­˜å‚¨è¿‡ç¨‹ï¼‰
- [ ] é¢†ç”¨å•å·è‡ªåŠ¨ç”Ÿæˆï¼ˆå­˜å‚¨è¿‡ç¨‹ï¼‰
- [ ] ç»Ÿè®¡åŠŸèƒ½è°ƒç”¨å­˜å‚¨è¿‡ç¨‹
- [ ] åº“å­˜ä¸è¶³æ—¶ä¸èƒ½å‘æ”¾ï¼ˆè§¦å‘å™¨æ£€æŸ¥ï¼‰

---

**ç¥æµ‹è¯•é¡ºåˆ©ï¼ğŸ‰**
